<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <title>Email notifications</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Modal look consistent with other tabs; no orange borders */
    dialog {
      border: none;
      outline: none;
      border-radius: 16px;
      background: var(--card);
      color: var(--text);
      padding: 16px 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.5);
    }
    dialog::backdrop { background: rgba(0,0,0,.55); }

    /* Compact, tidy grid */
    #ruleForm { min-width: 820px; }
    .rule-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:flex-start;
    }
    .rule-grid label{ display:flex; flex-direction:column; gap:6px; }
    .rule-grid .full{ grid-column: 1 / -1; }

    /* Dropdown helpers (inherit project palette) */
    .dd{ position:relative; }
    .dd-btn{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      width:100%; cursor:pointer;
      background:var(--input); border:1px solid var(--border); border-radius:10px; padding:8px 10px;
    }
    .dd-panel{
      position:absolute; top:calc(100% + 6px); left:0; right:0; z-index:10000; display:none;
      max-height:280px; overflow:auto; background:var(--card);
      border:1px solid var(--border); border-radius:12px; box-shadow:0 16px 40px rgba(0,0,0,.35); padding:8px;
    }
    .dd.open .dd-panel{ display:block; }
    .dd-search{ width:100%; margin-bottom:8px; }
    .dd-list{ display:flex; flex-direction:column; gap:6px; }
    .dd-row{ display:flex; align-items:center; gap:8px; padding:6px; border-radius:8px; }
    .dd-row:hover{ background:rgba(255,255,255,.04); }
    .dd-empty{ padding:8px; opacity:.7; text-align:center; font-size:12px; }

    .chips{ display:flex; flex-wrap:wrap; gap:6px; }
    .chip{ padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:var(--chip, var(--card)); }

    /* Keep green buttons readable on hover (don’t invert to white text on white) */
    .btn.btn-green:hover { color: #fff; filter: brightness(0.95); }
  </style>
</head>
<body>
  <header>
    <h1>Email notifications</h1>
    <nav>
      <a class="card" href="./matching.html">Matching</a>
      <a class="card" href="./comparison.html">Comparison</a>
      <a class="card" href="./tags.html">Tags</a>
      <a class="card" href="./erp.html">ERP Import</a>
    </nav>
  </header>

  <main class="container">
    <section>
      <h4>Schedule</h4>
      <table class="table schedule-table">
        <thead>
          <tr>
            <th>Monday</th><th>Tuesday</th><th>Wednesday</th>
            <th>Thursday</th><th>Friday</th><th>Saturday</th><th>Sunday</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input id="sch_mon" type="time" placeholder="10:00"></td>
            <td><input id="sch_tue" type="time" placeholder="10:00"></td>
            <td><input id="sch_wed" type="time" placeholder="10:00"></td>
            <td><input id="sch_thu" type="time" placeholder="10:00"></td>
            <td><input id="sch_fri" type="time" placeholder="10:00"></td>
            <td><input id="sch_sat" type="time" placeholder="-"></td>
            <td><input id="sch_sun" type="time" placeholder="-"></td>
          </tr>
        </tbody>
      </table>
      <div class="toolbar">
        <button class="btn btn-green" id="btnSaveSchedule">Save schedule</button>
        <button class="btn btn-outline" id="btnSendAll">Send ALL now</button>
      </div>
    </section>

    <section style="margin-top:18px">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h4 style="margin:0">Notification rules</h4>
        <button class="btn btn-green" id="btnAdd">+ Add</button>
      </div>

      <div class="toolbar">
        <input id="search" placeholder="Search name/email…">
        <span id="records" class="muted"></span>
      </div>

      <table class="table" id="rulesTable">
        <thead>
          <tr>
            <th style="width:220px">Name</th>
            <th>Tags</th>
            <th>Promo only</th>
            <th>Changed 24h</th>
            <th>Brand</th>
            <th>Category</th>
            <th>Store</th>
            <th>Subscribers</th>
            <th>Notes</th>
            <th>Created on</th>
            <th style="width:220px">*</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- Add/Edit dialog -->
  <dialog id="ruleDlg">
    <form method="dialog" id="ruleForm">
      <h3 id="dlgTitle" style="margin-top:0;margin-bottom:10px">Add rule</h3>

      <div class="rule-grid">
        <label>Name <input id="r_name" required></label>
        <label>Site / Group
          <select id="r_site"><option value="all">All competitors</option></select>
        </label>

        <!-- TAGS dropdown (custom) -->
        <div class="dd" id="tagsDD">
          <label style="gap:8px">
            <span>Tags (multi)</span>
            <button type="button" class="dd-btn" id="tagsBtn"><span id="tagsBtnText">— All tags —</span><span>▾</span></button>
            <div class="dd-panel">
              <input class="dd-search" id="tagsSearch" placeholder="Search tags…">
              <div class="dd-list" id="tagsList"></div>
              <div class="dd-empty" id="tagsEmpty" style="display:none">No tags</div>
            </div>
          </label>
          <input type="hidden" id="r_tags">
          <div class="chips" id="tagsChips" style="margin-top:6px"></div>
        </div>

        <!-- Brand dropdown -->
        <label>Brand
          <select id="r_brand"><option value="">— Any —</option></select>
        </label>

        <!-- Category full-path dropdown -->
        <div class="dd" id="catDD">
          <label style="gap:8px">
            <span>Category</span>
            <button type="button" class="dd-btn" id="catBtn"><span id="catBtnText">— All categories —</span><span>▾</span></button>
            <div class="dd-panel">
              <input class="dd-search" id="catSearch" placeholder="Search categories…">
              <div class="dd-list" id="catList"></div>
              <div class="dd-empty" id="catEmpty" style="display:none">No categories</div>
            </div>
          </label>
          <input type="hidden" id="r_category">
        </div>

        <!-- Checkboxes -->
        <label style="align-items:flex-start">
          <span>Promo only</span>
          <input type="checkbox" id="r_promo" style="margin-top:6px">
        </label>

        <label style="align-items:flex-start">
          <span>Changed in last 24h</span>
          <input type="checkbox" id="r_changed24" style="margin-top:6px">
        </label>

        <label>Price direction
          <select id="r_direction">
            <option value="any">Any</option>
            <option value="better">Ours lower</option>
            <option value="worse">Ours higher</option>
          </select>
        </label>

        <label>Subscribers (comma separated)
          <input id="r_emails" placeholder="a@b.com, c@d.com">
        </label>

        <label class="full">Notes
          <textarea id="r_notes" placeholder=""></textarea>
        </label>
      </div>

      <div style="display:flex;align-items:center;justify-content:flex-end;gap:8px;margin-top:16px">
        <span class="muted">● Required: name</span>
        <button type="button" class="btn" id="btnCancel">Cancel</button>
        <button type="submit" class="btn btn-green" id="btnSaveRule">Save</button>
      </div>
    </form>
  </dialog>

  <script type="module" src="./email.js"></script>
</body>
</html>
